<svg width="1400" height="1000" xmlns="http://www.w3.org/2000/svg">
  <defs>
    <!-- 定义渐变色 -->
    <linearGradient id="protocolGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#4F46E5;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#7C3AED;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="indexerGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#059669;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#0D9488;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="infraGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#DC2626;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#EA580C;stop-opacity:1" />
    </linearGradient>
    <linearGradient id="clientGradient" x1="0%" y1="0%" x2="100%" y2="100%">
      <stop offset="0%" style="stop-color:#7C2D12;stop-opacity:1" />
      <stop offset="100%" style="stop-color:#A16207;stop-opacity:1" />
    </linearGradient>
    
    <!-- 箭头标记 -->
    <defs>
      <marker id="arrowhead" markerWidth="10" markerHeight="7" 
       refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#374151" />
      </marker>
      <marker id="arrowhead-blue" markerWidth="10" markerHeight="7" 
       refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#3B82F6" />
      </marker>
      <marker id="arrowhead-green" markerWidth="10" markerHeight="7" 
       refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#10B981" />
      </marker>
      <marker id="arrowhead-red" markerWidth="10" markerHeight="7" 
       refX="9" refY="3.5" orient="auto">
        <polygon points="0 0, 10 3.5, 0 7" fill="#EF4444" />
      </marker>
    </defs>
  </defs>

  <!-- 背景 -->
  <rect width="1400" height="1000" fill="#F9FAFB"/>
  
  <!-- 标题 -->
  <text x="700" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="24" font-weight="bold" fill="#111827">
    dYdX v4 服务架构拓扑图
  </text>

  <!-- Protocol 区块链节点服务区域 -->
  <g id="protocol-layer">
    <rect x="50" y="60" width="500" height="320" rx="10" fill="url(#protocolGradient)" opacity="0.1" stroke="#4F46E5" stroke-width="2"/>
    <text x="300" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#4F46E5">
      Protocol 区块链节点服务
    </text>
    
    <!-- Protocol 核心模块 -->
    <rect x="70" y="100" width="120" height="60" rx="5" fill="url(#protocolGradient)" opacity="0.8"/>
    <text x="130" y="125" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">App Core</text>
    <text x="130" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">应用核心</text>
    <text x="130" y="152" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">app.go</text>
    
    <!-- 业务模块 -->
    <rect x="210" y="100" width="80" height="40" rx="3" fill="#6366F1" opacity="0.9"/>
    <text x="250" y="118" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">CLOB</text>
    <text x="250" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">订单簿</text>
    
    <rect x="300" y="100" width="80" height="40" rx="3" fill="#6366F1" opacity="0.9"/>
    <text x="340" y="118" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Perpetuals</text>
    <text x="340" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">永续合约</text>
    
    <rect x="390" y="100" width="80" height="40" rx="3" fill="#6366F1" opacity="0.9"/>
    <text x="430" y="118" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Subaccounts</text>
    <text x="430" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">子账户</text>
    
    <rect x="480" y="100" width="60" height="40" rx="3" fill="#6366F1" opacity="0.9"/>
    <text x="510" y="118" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Prices</text>
    <text x="510" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">价格</text>
    
    <!-- 更多模块 -->
    <rect x="210" y="150" width="70" height="35" rx="3" fill="#8B5CF6" opacity="0.9"/>
    <text x="245" y="168" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Assets</text>
    <text x="245" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">资产</text>
    
    <rect x="290" y="150" width="70" height="35" rx="3" fill="#8B5CF6" opacity="0.9"/>
    <text x="325" y="168" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Bridge</text>
    <text x="325" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">跨链桥</text>
    
    <rect x="370" y="150" width="70" height="35" rx="3" fill="#8B5CF6" opacity="0.9"/>
    <text x="405" y="168" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Rewards</text>
    <text x="405" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">奖励</text>
    
    <rect x="450" y="150" width="70" height="35" rx="3" fill="#8B5CF6" opacity="0.9"/>
    <text x="485" y="168" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" font-weight="bold" fill="white">Vault</text>
    <text x="485" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">金库</text>
    
    <!-- Indexer Event Manager -->
    <rect x="70" y="200" width="180" height="50" rx="5" fill="#7C3AED" opacity="0.9"/>
    <text x="160" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">IndexerEventManager</text>
    <text x="160" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">事件管理器</text>
    <text x="160" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ProduceBlock() / SendData()</text>
    
    <!-- Message Sender -->
    <rect x="270" y="200" width="180" height="50" rx="5" fill="#7C3AED" opacity="0.9"/>
    <text x="360" y="220" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">IndexerMessageSender</text>
    <text x="360" y="235" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">消息发送器</text>
    <text x="360" y="245" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Kafka Producer</text>
    
    <!-- Daemons -->
    <rect x="70" y="270" width="100" height="40" rx="3" fill="#A855F7" opacity="0.9"/>
    <text x="120" y="288" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Price Feed</text>
    <text x="120" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">价格守护进程</text>
    
    <rect x="180" y="270" width="100" height="40" rx="3" fill="#A855F7" opacity="0.9"/>
    <text x="230" y="288" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Bridge</text>
    <text x="230" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">桥接守护进程</text>
    
    <rect x="290" y="270" width="100" height="40" rx="3" fill="#A855F7" opacity="0.9"/>
    <text x="340" y="288" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Liquidation</text>
    <text x="340" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">清算守护进程</text>
    
    <!-- Streaming -->
    <rect x="400" y="270" width="120" height="40" rx="3" fill="#A855F7" opacity="0.9"/>
    <text x="460" y="288" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">Full Node Streaming</text>
    <text x="460" y="300" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">全节点流式传输</text>
  </g>

  <!-- Kafka 消息队列 -->
  <g id="kafka-layer">
    <rect x="600" y="60" width="200" height="320" rx="10" fill="url(#infraGradient)" opacity="0.1" stroke="#DC2626" stroke-width="2"/>
    <text x="700" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#DC2626">
      Kafka 消息队列
    </text>
    
    <!-- TO_ENDER Topic -->
    <rect x="620" y="110" width="160" height="40" rx="5" fill="#EF4444" opacity="0.9"/>
    <text x="700" y="128" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">TO_ENDER</text>
    <text x="700" y="140" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">链上数据主题</text>
    
    <!-- TO_VULCAN Topic -->
    <rect x="620" y="160" width="160" height="40" rx="5" fill="#EF4444" opacity="0.9"/>
    <text x="700" y="178" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">TO_VULCAN</text>
    <text x="700" y="190" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">离链数据主题</text>
    
    <!-- WebSocket Topics -->
    <rect x="620" y="210" width="160" height="60" rx="5" fill="#F97316" opacity="0.9"/>
    <text x="700" y="228" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" font-weight="bold" fill="white">WebSocket Topics</text>
    <text x="700" y="240" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">• TO_WEBSOCKETS_TRADES</text>
    <text x="700" y="250" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">• TO_WEBSOCKETS_SUBACCOUNTS</text>
    <text x="700" y="260" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="white">• TO_WEBSOCKETS_MARKETS</text>
    
    <!-- Bazooka Service -->
    <rect x="620" y="290" width="160" height="40" rx="5" fill="#DC2626" opacity="0.9"/>
    <text x="700" y="308" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">Bazooka</text>
    <text x="700" y="320" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">主题管理服务</text>
  </g>

  <!-- Indexer 微服务层 -->
  <g id="indexer-layer">
    <rect x="850" y="60" width="500" height="320" rx="10" fill="url(#indexerGradient)" opacity="0.1" stroke="#059669" stroke-width="2"/>
    <text x="1100" y="85" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#059669">
      Indexer 微服务架构
    </text>
    
    <!-- Ender Service -->
    <rect x="870" y="100" width="120" height="60" rx="5" fill="url(#indexerGradient)" opacity="0.9"/>
    <text x="930" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Ender</text>
    <text x="930" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">链上数据归档</text>
    <text x="930" y="148" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">BlockProcessor</text>
    <text x="930" y="158" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">事件处理</text>
    
    <!-- Vulcan Service -->
    <rect x="1010" y="100" width="120" height="60" rx="5" fill="#10B981" opacity="0.9"/>
    <text x="1070" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Vulcan</text>
    <text x="1070" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">离链数据归档</text>
    <text x="1070" y="148" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">订单处理</text>
    
    <!-- Comlink Service -->
    <rect x="1150" y="100" width="120" height="60" rx="5" fill="#10B981" opacity="0.9"/>
    <text x="1210" y="120" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Comlink</text>
    <text x="1210" y="135" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">API 服务</text>
    <text x="1210" y="148" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">REST API</text>
    <text x="1210" y="158" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">GraphQL</text>
    
    <!-- Socks Service -->
    <rect x="870" y="180" width="120" height="60" rx="5" fill="#10B981" opacity="0.9"/>
    <text x="930" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Socks</text>
    <text x="930" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">WebSocket 服务</text>
    <text x="930" y="228" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">实时数据推送</text>
    
    <!-- Roundtable Service -->
    <rect x="1010" y="180" width="120" height="60" rx="5" fill="#10B981" opacity="0.9"/>
    <text x="1070" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Roundtable</text>
    <text x="1070" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">任务调度</text>
    <text x="1070" y="228" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">定时任务</text>
    <text x="1070" y="238" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Cron Jobs</text>
    
    <!-- Auxo Service -->
    <rect x="1150" y="180" width="120" height="60" rx="5" fill="#10B981" opacity="0.9"/>
    <text x="1210" y="200" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Auxo</text>
    <text x="1210" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">部署管理</text>
    <text x="1210" y="228" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">ECS 服务升级</text>
    <text x="1210" y="238" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">Lambda 函数</text>
    
    <!-- Scripts -->
    <rect x="870" y="260" width="180" height="40" rx="5" fill="#059669" opacity="0.9"/>
    <text x="960" y="278" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="white">Scripts & Tools</text>
    <text x="960" y="290" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">数据迁移、工具脚本</text>
  </g>

  <!-- 基础设施层 -->
  <g id="infrastructure-layer">
    <rect x="50" y="420" width="1300" height="180" rx="10" fill="url(#infraGradient)" opacity="0.1" stroke="#DC2626" stroke-width="2"/>
    <text x="700" y="445" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#DC2626">
      基础设施层
    </text>
    
    <!-- PostgreSQL -->
    <rect x="100" y="460" width="200" height="80" rx="5" fill="#DC2626" opacity="0.9"/>
    <text x="200" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">PostgreSQL</text>
    <text x="200" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">主数据库</text>
    <text x="200" y="512" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 订单数据</text>
    <text x="200" y="522" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 账户信息</text>
    <text x="200" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 交易历史</text>
    
    <!-- Redis -->
    <rect x="350" y="460" width="200" height="80" rx="5" fill="#EF4444" opacity="0.9"/>
    <text x="450" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Redis</text>
    <text x="450" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">缓存数据库</text>
    <text x="450" y="512" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 订单簿缓存</text>
    <text x="450" y="522" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 价格缓存</text>
    <text x="450" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 会话存储</text>
    
    <!-- Kafka Cluster -->
    <rect x="600" y="460" width="200" height="80" rx="5" fill="#F97316" opacity="0.9"/>
    <text x="700" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">Kafka Cluster</text>
    <text x="700" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">消息队列集群</text>
    <text x="700" y="512" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 多分区</text>
    <text x="700" y="522" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 高可用</text>
    <text x="700" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 持久化</text>
    
    <!-- Monitoring -->
    <rect x="850" y="460" width="200" height="80" rx="5" fill="#7C2D12" opacity="0.9"/>
    <text x="950" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">监控系统</text>
    <text x="950" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">Monitoring & Logging</text>
    <text x="950" y="512" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Bugsnag</text>
    <text x="950" y="522" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Datadog</text>
    <text x="950" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• Prometheus</text>
    
    <!-- External Services -->
    <rect x="1100" y="460" width="200" height="80" rx="5" fill="#A16207" opacity="0.9"/>
    <text x="1200" y="485" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="white">外部服务</text>
    <text x="1200" y="500" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">External Services</text>
    <text x="1200" y="512" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 价格预言机</text>
    <text x="1200" y="522" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 跨链桥</text>
    <text x="1200" y="532" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">• 第三方 API</text>
  </g>

  <!-- 客户端层 -->
  <g id="client-layer">
    <rect x="50" y="640" width="1300" height="120" rx="10" fill="url(#clientGradient)" opacity="0.1" stroke="#7C2D12" stroke-width="2"/>
    <text x="700" y="665" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#7C2D12">
      客户端层
    </text>
    
    <!-- Web App -->
    <rect x="200" y="680" width="150" height="60" rx="5" fill="#7C2D12" opacity="0.9"/>
    <text x="275" y="705" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">Web 应用</text>
    <text x="275" y="720" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">React/Vue 前端</text>
    <text x="275" y="732" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">交易界面</text>
    
    <!-- Mobile App -->
    <rect x="400" y="680" width="150" height="60" rx="5" fill="#A16207" opacity="0.9"/>
    <text x="475" y="705" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">移动应用</text>
    <text x="475" y="720" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">iOS/Android</text>
    <text x="475" y="732" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">原生应用</text>
    
    <!-- Trading Bots -->
    <rect x="600" y="680" width="150" height="60" rx="5" fill="#92400E" opacity="0.9"/>
    <text x="675" y="705" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">交易机器人</text>
    <text x="675" y="720" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">API 客户端</text>
    <text x="675" y="732" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">自动化交易</text>
    
    <!-- Third Party -->
    <rect x="800" y="680" width="150" height="60" rx="5" fill="#78350F" opacity="0.9"/>
    <text x="875" y="705" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">第三方集成</text>
    <text x="875" y="720" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">钱包、聚合器</text>
    <text x="875" y="732" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">DeFi 生态</text>
    
    <!-- Analytics -->
    <rect x="1000" y="680" width="150" height="60" rx="5" fill="#451A03" opacity="0.9"/>
    <text x="1075" y="705" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="white">数据分析</text>
    <text x="1075" y="720" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="white">图表、统计</text>
    <text x="1075" y="732" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="white">市场数据</text>
  </g>

  <!-- 数据流箭头 -->
  <!-- Protocol to Kafka -->
  <line x1="450" y1="225" x2="620" y2="130" stroke="#3B82F6" stroke-width="3" marker-end="url(#arrowhead-blue)"/>
  <text x="535" y="170" font-family="Arial, sans-serif" font-size="10" fill="#3B82F6" font-weight="bold">链上数据</text>
  
  <line x1="450" y1="225" x2="620" y2="180" stroke="#10B981" stroke-width="3" marker-end="url(#arrowhead-green)"/>
  <text x="535" y="210" font-family="Arial, sans-serif" font-size="10" fill="#10B981" font-weight="bold">离链数据</text>
  
  <!-- Kafka to Indexer Services -->
  <line x1="780" y1="130" x2="870" y2="130" stroke="#3B82F6" stroke-width="3" marker-end="url(#arrowhead-blue)"/>
  <text x="815" y="125" font-family="Arial, sans-serif" font-size="9" fill="#3B82F6">TO_ENDER</text>
  
  <line x1="780" y1="180" x2="1010" y2="130" stroke="#10B981" stroke-width="3" marker-end="url(#arrowhead-green)"/>
  <text x="885" y="150" font-family="Arial, sans-serif" font-size="9" fill="#10B981">TO_VULCAN</text>
  
  <!-- Ender to WebSocket Topics -->
  <line x1="930" y1="160" x2="780" y2="235" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  <text x="845" y="195" font-family="Arial, sans-serif" font-size="9" fill="#EF4444">WebSocket 消息</text>
  
  <!-- WebSocket Topics to Socks -->
  <line x1="780" y1="235" x2="870" y2="210" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowhead-red)"/>
  
  <!-- Services to Infrastructure -->
  <line x1="930" y1="240" x2="200" y2="460" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1070" y1="240" x2="450" y2="460" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="1210" y1="240" x2="200" y2="460" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Infrastructure to Services (读取) -->
  <line x1="200" y1="460" x2="1210" y2="240" stroke="#6B7280" stroke-width="1" stroke-dasharray="5,5"/>
  <line x1="450" y1="460" x2="930" y2="240" stroke="#6B7280" stroke-width="1" stroke-dasharray="5,5"/>
  
  <!-- Clients to API -->
  <line x1="275" y1="680" x2="1210" y2="240" stroke="#7C2D12" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="475" y1="680" x2="1210" y2="240" stroke="#7C2D12" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="675" y1="680" x2="1210" y2="240" stroke="#7C2D12" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- Clients to WebSocket -->
  <line x1="275" y1="680" x2="930" y2="240" stroke="#A16207" stroke-width="2" marker-end="url(#arrowhead)"/>
  <line x1="475" y1="680" x2="930" y2="240" stroke="#A16207" stroke-width="2" marker-end="url(#arrowhead)"/>
  
  <!-- 图例 -->
  <g id="legend">
    <rect x="50" y="800" width="1300" height="150" rx="10" fill="white" stroke="#D1D5DB" stroke-width="1"/>
    <text x="700" y="825" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#111827">
      数据流图例
    </text>
    
    <!-- 数据流说明 -->
    <line x1="100" y1="850" x2="150" y2="850" stroke="#3B82F6" stroke-width="3" marker-end="url(#arrowhead-blue)"/>
    <text x="160" y="855" font-family="Arial, sans-serif" font-size="12" fill="#374151">链上数据流 (Protocol → Kafka → Ender)</text>
    
    <line x1="100" y1="870" x2="150" y2="870" stroke="#10B981" stroke-width="3" marker-end="url(#arrowhead-green)"/>
    <text x="160" y="875" font-family="Arial, sans-serif" font-size="12" fill="#374151">离链数据流 (Protocol → Kafka → Vulcan)</text>
    
    <line x1="100" y1="890" x2="150" y2="890" stroke="#EF4444" stroke-width="2" marker-end="url(#arrowhead-red)"/>
    <text x="160" y="895" font-family="Arial, sans-serif" font-size="12" fill="#374151">WebSocket 消息流 (Ender → Kafka → Socks)</text>
    
    <line x1="100" y1="910" x2="150" y2="910" stroke="#374151" stroke-width="2" marker-end="url(#arrowhead)"/>
    <text x="160" y="915" font-family="Arial, sans-serif" font-size="12" fill="#374151">数据库写入</text>
    
    <line x1="100" y1="930" x2="150" y2="930" stroke="#6B7280" stroke-width="1" stroke-dasharray="5,5"/>
    <text x="160" y="935" font-family="Arial, sans-serif" font-size="12" fill="#374151">数据库读取</text>
    
    <!-- 关键特性说明 -->
    <text x="500" y="855" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#374151">关键特性:</text>
    <text x="500" y="875" font-family="Arial, sans-serif" font-size="11" fill="#374151">• 实时数据处理: 区块数据实时传输到 indexer 服务</text>
    <text x="500" y="890" font-family="Arial, sans-serif" font-size="11" fill="#374151">• 微服务架构: 各服务独立部署，职责分离</text>
    <text x="500" y="905" font-family="Arial, sans-serif" font-size="11" fill="#374151">• 高可用性: Kafka 集群保证消息不丢失</text>
    <text x="500" y="920" font-family="Arial, sans-serif" font-size="11" fill="#374151">• 水平扩展: 支持多实例部署和负载均衡</text>
    <text x="500" y="935" font-family="Arial, sans-serif" font-size="11" fill="#374151">• 数据一致性: 通过事务保证数据完整性</text>
    
    <!-- 服务说明 -->
    <text x="900" y="855" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#374151">服务职责:</text>
    <text x="900" y="875" font-family="Arial, sans-serif" font-size="11" fill="#374151">• Ender: 链上数据归档和事件处理</text>
    <text x="900" y="890" font-family="Arial, sans-serif" font-size="11" fill="#374151">• Vulcan: 离链数据处理和订单管理</text>
    <text x="900" y="905" font-family="Arial, sans-serif" font-size="11" fill="#374151">• Comlink: REST API 和 GraphQL 服务</text>
    <text x="900" y="920" font-family="Arial, sans-serif" font-size="11" fill="#374151">• Socks: WebSocket 实时数据推送</text>
    <text x="900" y="935" font-family="Arial, sans-serif" font-size="11" fill="#374151">• Roundtable: 定时任务和数据维护</text>
  </g>
</svg>